<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: cmdsUtility.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: cmdsUtility.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @module */

const storage = require('./storage');
const labels = require('./labels');
const socketHandler = require('./socketHandler');
const textTools = require('./textTools');
const messenger = require('./messenger');
const commandHandler = require('./commandHandler');
const domManipulator = require('./domManipulator');

/**
 * @static
 * @type {Object}
 */
const commands = {};

commands.invitations = {
  func: () => {
    socketHandler.emit('getInvitations');
  },
  steps: [
    (data) => {
      const commandHelper = commandHandler.commandHelper;
      const sentInvitations = data.invitations;
      const text = [];
      commandHelper.data = data;

      if (sentInvitations.length > 0) {
        for (let i = 0; i &lt; sentInvitations.length; i++) {
          const invitation = sentInvitations[i];
          const itemNumber = i + 1;

          text.push(`&lt;${itemNumber}> Join ${invitation.invitationType} ${invitation.itemName}. Sent by ${invitation.sender}`);
        }

        messenger.queueMessage({ text: textTools.createCommandStart('Invitations').concat(text, textTools.createCommandEnd()) });
        messenger.queueMessage({
          text: ['Answer the invite with accept or decline. Example: 1 decline'],
          text_se: ['Besvara inbjudan med accept eller decline. Exempel: 1 decline'],
        });
        messenger.queueMessage({ text: labels.getText('info', 'cancel') });
        domManipulator.setInputStart('answer');
        commandHelper.onStep++;
      } else {
        messenger.queueMessage({
          text: ['You have no invitations'],
          text_se: ['Ni har inga inbjudan'],
        });
        commandHandler.resetCommand(false);
      }
    },
    (phrases) => {
      if (phrases.length > 1) {
        const itemNumber = phrases[0] - 1;
        const answer = phrases[1].toLowerCase();
        const invitation = commandHandler.commandHelper.data.invitations[itemNumber];

        if (['accept', 'a', 'decline', 'd'].indexOf(answer) > -1) {
          const accepted = ['accept', 'a'].indexOf(answer) > -1;
          const data = { accepted, invitation };

          switch (invitation.invitationType) {
            case 'team': {
              socketHandler.emit('teamAnswer', data);

              break;
            }
            case 'room': {
              socketHandler.emit('roomAnswer', data);

              break;
            }
            default: {
              break;
            }
          }

          commandHandler.resetCommand(false);
        } else {
          messenger.queueMessage({
            text: ['You have to either accept or decline the invitation'],
            text_se: ['Ni måste antingen acceptera eller avböja inbjudan'],
          });
        }
      } else {
        commandHandler.resetCommand(true);
      }
    },
  ],
  accessLevel: 13,
  category: 'basic',
  commandName: 'invitations',
};

commands.time = {
  func: () => {
    socketHandler.emit('time');
  },
  accessLevel: 13,
  category: 'basic',
  commandName: 'time',
};

commands.weather = {
  func: () => {
    socketHandler.emit('weather');
  },
  accessLevel: 1,
  category: 'basic',
  commandName: 'weather',
};

commands.mode = {
  func: (phrases, verbose) => {
    const commandChars = commandHandler.getCommandChars();
    let commandString;

    if (phrases.length > 0) {
      const newMode = phrases[0].toLowerCase();

      // TODO Refactoring. Lots of duplicate code
      if (newMode === 'chat') {
        storage.setMode(newMode);

        if (verbose === undefined || verbose) {
          commandString = 'Chat mode activated';

          messenger.queueMessage({
            text: textTools.createCommandStart(commandString).concat([
              `Prepend commands with ${commandChars.join(' or ')}, example: ${commandChars[0]}mode`,
              'Everything else written and sent will be intepreted as a chat message',
              'You will no longer need to use msg command to type chat messages',
              'Use tab or type double space to see available commands and instructions',
              textTools.createCommandEnd(commandString.length),
            ]),
            text_se: textTools.createCommandStart(commandString).concat([
              `Lägg till ${commandChars.join(' eller ')} i början av varje kommando, exempel: ${commandChars[0]}mode`,
              'Allt annat ni skriver kommer att tolkas som chatmeddelanden',
              'Ni kommer inte längre behöva använda msg-kommandot för att skriva chatmeddelanden',
              'Använd tab-knappen eller skriv in två blanksteg för att se tillgängliga kommandon och instruktioner',
              textTools.createCommandEnd(commandString.length),
            ]),
          });
        }

        socketHandler.emit('updateMode', { mode: newMode });
      } else if (newMode === 'cmd') {
        storage.setMode(newMode);

        if (verbose === undefined || verbose) {
          commandString = 'Command mode activated';

          messenger.queueMessage({
            text: textTools.createCommandStart(commandString).concat([
              `Commands can be used without ${commandChars[0]}`,
              'You have to use command msg to send messages',
              textTools.createCommandEnd(commandString.length),
            ]),
            text_se: textTools.createCommandStart(commandString).concat([
              `Kommandon kan användas utan ${commandChars[0]}`,
              'Ni måste använda msg-kommandot för att skriva chatmeddelanden',
              textTools.createCommandEnd(commandString.length),
            ]),
          });
        }

        socketHandler.emit('updateMode', { mode: newMode });
      } else {
        messenger.queueMessage({
          text: [`${newMode} is not a valid mode`],
          text_se: [`${newMode} är inte ett giltigt alternativ`],
        });
      }
    } else {
      messenger.queueMessage({
        text: [`Current mode: ${storage.getMode()}`],
        text_se: [`Nuvarande läge: ${storage.getMode()}`],
      });
    }
  },
  autocomplete: { type: 'modes' },
  accessLevel: 13,
  category: 'advanced',
  commandName: 'mode',
  options: {
    chat: { description: 'Chat mode' },
    cmd: { description: 'Command mode' },
  },
};

module.exports = commands;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-audio.html">audio</a></li><li><a href="module-clickHandler.html">clickHandler</a></li><li><a href="module-cmdsAdmin.html">cmdsAdmin</a></li><li><a href="module-cmdsBbr.html">cmdsBbr</a></li><li><a href="module-cmdsChat.html">cmdsChat</a></li><li><a href="module-cmdsInfo.html">cmdsInfo</a></li><li><a href="module-cmdsLocal.html">cmdsLocal</a></li><li><a href="module-cmdsMap.html">cmdsMap</a></li><li><a href="module-cmdsSatellite.html">cmdsSatellite</a></li><li><a href="module-cmdsTeam.html">cmdsTeam</a></li><li><a href="module-cmdsUser.html">cmdsUser</a></li><li><a href="module-cmdsUtility.html">cmdsUtility</a></li><li><a href="module-commandHandler.html">commandHandler</a></li><li><a href="module-domManipulator.html">domManipulator</a></li><li><a href="module-labels.html">labels</a></li><li><a href="module-layoutChanger.html">layoutChanger</a></li><li><a href="module-mapTools.html">mapTools</a></li><li><a href="module-messenger.html">messenger</a></li><li><a href="module-painter.html">painter</a></li><li><a href="module-socketHandler.html">socketHandler</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-textTools.html">textTools</a></li><li><a href="module-videoPlayer.html">videoPlayer</a></li><li><a href="module-zalgoGenerator.html">zalgoGenerator</a></li></ul><h3>Global</h3><ul><li><a href="global.html#autoCompleteOption">autoCompleteOption</a></li><li><a href="global.html#commandQueue">commandQueue</a></li><li><a href="global.html#commandTime">commandTime</a></li><li><a href="global.html#goFullScreen">goFullScreen</a></li><li><a href="global.html#isScreenOff">isScreenOff</a></li><li><a href="global.html#isTouchDevice">isTouchDevice</a></li><li><a href="global.html#keyPressed">keyPressed</a></li><li><a href="global.html#keyReleased">keyReleased</a></li><li><a href="global.html#lastScreenOff">lastScreenOff</a></li><li><a href="global.html#match">match</a></li><li><a href="global.html#morseSeparator">morseSeparator</a></li><li><a href="global.html#onStartup">onStartup</a></li><li><a href="global.html#onVideoMessage">onVideoMessage</a></li><li><a href="global.html#pausePositionTime">pausePositionTime</a></li><li><a href="global.html#preparePosition">preparePosition</a></li><li><a href="global.html#refocus">refocus</a></li><li><a href="global.html#screenOffIntervalTime">screenOffIntervalTime</a></li><li><a href="global.html#setIntervals">setIntervals</a></li><li><a href="global.html#soundQueue">soundQueue</a></li><li><a href="global.html#watchPositionTime">watchPositionTime</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jun 21 2016 22:00:47 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
